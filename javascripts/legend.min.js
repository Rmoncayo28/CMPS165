d3.svg.legend=function(){function m(b){function e(){var a=b.append("g").attr("class","mutLegendGroup").data([g]).attr("transform","translate("+g.x+","+g.y+")"),c=a.insert("g").attr("class","mutLegendGroupText");a.insert("rect",":first-child").attr("class","mutLegendBG").attr("fill","white").attr("stroke","black").attr("stroke-width","1px");return{parentGroup:a,target:c}}function j(){m.target.selectAll("g.legendCells").data(a).exit().remove(),m.target.selectAll("g.legendCells").select("rect").style("fill",function(a){return a.color}),"vertical"==k?(m.target.selectAll("g.legendCells").select("text.breakLabels").style("display","block").style("text-anchor","start").attr("x",c+l).attr("y",5+d/2).text(function(a){return f(a.stop[0])+(a.stop[1].length>0?" - "+f(a.stop[1]):"")}),m.target.selectAll("g.legendCells").attr("transform",function(a,b){return"translate(0,"+b*(d+l)+")"})):(m.target.selectAll("g.legendCells").attr("transform",function(a,b){return"translate("+b*c+",0)"}),m.target.selectAll("text.breakLabels").style("text-anchor","middle").attr("x",0).attr("y",-7).style("display",function(a,b){return 0==b?"none":"block"}).text(function(a){return f(a.stop[0])}))}if(updateBGSize=function(a){var b=10;dim=a.target.node().getBBox(),dim.height+=2*b,dim.width+=2*b,dim.y-=b,dim.x-=b,a.parentGroup.select(".mutLegendBG").attr(dim)},drag=d3.behavior.drag().on("drag",function(a,b){console.log(this),a.x+=d3.event.dx,a.y+=d3.event.dy,d3.select(this).attr("transform",function(a,b){return"translate("+[a.x,a.y]+")"})}).on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}),!m.initDone){var n=e();m.target=n.target,m.parentGroup=n.parentGroup,m.parentGroup.call(drag),m.initDone=!0}m.target.selectAll("g.legendCells").select("text.breakLabels").remove(),m.target.selectAll("g.legendCells").select("rect").remove(),m.target.selectAll(".legendTitle").remove(),m.target.selectAll("g.legendCells").data(a).enter().append("g").attr("class","legendCells").attr("transform",function(a,b){return"translate("+b*(c+l)+",0)"}),m.target.selectAll("g.legendCells").append("rect").attr("class","breakRect").attr("height",d).attr("width",c).style("fill",function(a){return a.color}).style("stroke",function(a){return d3.rgb(a.color).darker()}),m.target.selectAll("g.legendCells").append("text").attr("class","breakLabels").style("pointer-events","none"),m.target.append("text").text(h).attr("y",-7).attr("class","legendTitle"),j(),updateBGSize(m)}var a=[{color:"red",stop:[0,1]},{color:"blue",stop:[1,2]},{color:"purple",stop:[2,3]},{color:"yellow",stop:[3,4]},{color:"Aquamarine",stop:[4,5]}],c=30,d=20,f=d3.format(".01f"),g={x:0,y:0},h="units",j=1,k="horizontal",l=0;return m.initDone=!1,m.target,m.inputScale=function(b){return arguments.length?(scale=b,a=[],scale.invertExtent?scale.range().forEach(function(b){var c={color:b,stop:scale.invertExtent(b)};a.push(c)}):scale.domain().forEach(function(b){var c={color:scale(b),stop:[b,""]};a.push(c)}),this):scale},m.scale=function(b){var c=a[a.length-1].color;for(el in a)if(b<a[el].stop[1]){c=a[el].color;break}return c},m.cellWidth=function(a){return arguments.length?(c=a,this):c},m.cellHeight=function(a){return arguments.length?(d=a,this):d},m.cellPadding=function(a){return arguments.length?(l=a,this):l},m.cellExtent=function(b,c){var d=a.filter(function(a){return a.color==b})[0].stop;return 1==arguments.length?d:(a.filter(function(a){return a.color==b})[0].stop=c,this)},m.cellStepping=function(a){return arguments.length?(j=a,this):j},m.units=function(a){return arguments.length?(h=a,this):h},m.orientation=function(a){return arguments.length?(k=a,this):k},m.labelFormat=function(a){return arguments.length?(f=a,"none"==a&&(f=function(a){return a}),this):f},m.place=function(a){return arguments.length?(g=a,this):a},m};