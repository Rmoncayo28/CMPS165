function mouseover(t){div.style("display","inline")}function mousemove(t){numbers?div.html("<p style=text-align:center> <strong> <font size=3>"+t.properties.county_name+" Tract </strong> </font> <p style=text-align:left> GeoID: <span style=float:right;>"+t.properties.GEOID+"</span> </p><p style=text-align:left> Total Population: <span style=float:right;>"+t.properties.population+"</span> </p><p style=text-align:left> 18+ in College: <span style=float:right;>"+t.properties.numInCol+"</span> </p><p style=text-align:left> Insured <span style=float:right;>"+t.properties.total_insured+"</span> </p><p style=text-align:left> Living in Poverty: <span style=float:right;>"+t.properties.total_poverty+"</span> </p>").style("left",d3.event.pageX-260+"px").style("top",d3.event.pageY+20+"px"):div.html("<p style=text-align:center> <strong> <font size=3>"+t.properties.county_name+" Tract </strong> </font> <p style=text-align:left> GeoID: <span style=float:right;>"+t.properties.GEOID+"</span> </p><p style=text-align:left> Total Population: <span style=float:right;>"+t.properties.population+"</span> </p><p style=text-align:left> % of 18+ in College: <span style=float:right;>"+t.properties.inColCent+"</span> </p><p style=text-align:left> % Insured <span style=float:right;>"+t.properties.percent_insured+"</span> </p><p style=text-align:left> % Living in Poverty: <span style=float:right;>"+t.properties.percent_poverty+"</span> </p>").style("left",d3.event.pageX-260+"px").style("top",d3.event.pageY+20+"px")}function mouseout(t){div.style("display","none")}function zoomed(){0===d3.event.translate[0]&&0===d3.event.translate[0]&&window.scrollBy(0,80);var t=d3.event,e=Math.min(0,Math.max(t.translate[0],width-width*t.scale)),a=Math.min(0,Math.max(t.translate[1],height-height*t.scale));zoom.translate([e,a]),g.attr("transform",["translate("+[e,a]+")","scale("+t.scale+")"].join(" "))}var width=$(window).width()-45,height=490,projection=d3.geo.mercator().scale(2050).center([-121,36.7783]).translate([0,height/2]),zoom=d3.behavior.zoom().scaleExtent([1,200]).on("zoom",zoomed),path=d3.geo.path().projection(projection),svg=d3.select("#map").append("svg").attr("width",width).attr("height",height).append("g");svg.call(zoom);var g=svg.append("g"),blueColors=colorbrewer.Blues[5];blueColors.unshift("#ffffff");var educationScale=d3.scale.threshold().domain([0,2.67,5.34,10.68,44.66,100.1]).range(blueColors),educationScaleNum=d3.scale.threshold().domain([0,99,198,396,6030,11665]).range(colorbrewer.Blues[5]),greenColors=colorbrewer.Greens[5];greenColors.unshift("#ffffff");var healthScale=d3.scale.threshold().domain([0,20.69875,41.3975,82.795,91.398,100.1]).range(greenColors),healthScaleNum=d3.scale.threshold().domain([0,972.496425019,1944.99285004,3889.9857000746083,13543.49285,23198]).range(greenColors),purpleColors=colorbrewer.Purples[5];purpleColors.unshift("#ffffff");var purpleColorsNum=purpleColors.slice(0);purpleColors.push("#696969");var povertyScale=d3.scale.threshold().domain([0,4.15,8.3,16.6,33.2,66.4,100.1]).range(purpleColors),povertyScaleNum=d3.scale.threshold().domain([0,190.103332504,380.206665009,760.4133300174086,3246.20666501,5733]).range(purpleColorsNum),formatPercent=d3.format(".0%"),keyScale=d3.scale.linear().domain([0,1]).range([0,3]),keyScaleNum=d3.scale.linear().domain([0,1]).range([0,.03]),tickDistance=educationScale.domain(),tickDistanceNum=educationScaleNum.domain(),keyAxis=d3.svg.axis().scale(keyScale).orient("bottom").tickSize(17).tickFormat(function(t){var e=tickDistance.indexOf(t),a=e+1;return 100.1===t||0!==a&&tickDistance[a]-tickDistance[e]>10?"   "+Math.round(t)+"%":Math.round(t)});jQuery.fn.d3Click=function(){this.each(function(t,e){var a=new MouseEvent("click");e.dispatchEvent(a)})};var keyAxisNum=d3.svg.axis().scale(keyScaleNum).orient("bottom").tickSize(17).tickFormat(function(t){var e=tickDistanceNum.indexOf(t),a=e-1;return 0===e||tickDistanceNum[e]-tickDistanceNum[a]>990?Math.round(t):void 0}),selected={},mapX=width/2,mapY=0,map21X=width/4,map21Y=0,map22X=3*width/4,map22Y=0,map31X=.2*width,map31Y=0,map32X=width/2,map32Y=0,map33X=.8*width,map33Y=0,dataType="education",numbers=!1;d3.json("dataSets/caEduHealthPovertyBound.json",function(t,e){function a(t,e,a,r,n){return jQuery(function(e){e.ajax({url:t,dataType:"jsonp",success:function(t){var e=t.result.addressMatches[0].geographies["Census Tracts"][0].GEOID;console.log(t.result.addressMatches[0].geographies["Census Tracts"][0].GEOID),void 0===selected[parseInt(e)]&&(console.log(d3.select("#P"+parseInt(e)).datum().properties.GEOID),selected[d3.select("#P"+parseInt(e)).datum().properties.GEOID]=d3.select("#P"+parseInt(e)),l(d3.select("#P"+parseInt(e)),d3.select("#P"+parseInt(e)).datum(),educationScale,"inColCent"),i(d3.select("#P"+parseInt(e)).datum().properties.GEOID,!1))},error:function(t){return document.getElementById("errorText").innerHTML="invalid address",console.log("error"),console.log(t),!1}})}),!0}if(t)throw t;$(".my-form").on("submit",function(){document.getElementById("errorText").innerHTML="";var t=document.getElementById("form"),e="";e=t.elements[1].value;var r="";r=t.elements[2].value;var n="";n=t.elements[3].value;var i="ca";console.log(e,r,n),void 0!=e&&(e=e.replace(/ /g,"+")),r=r.replace(/ /g,"+");var o="https://geocoding.geo.census.gov/geocoder/geographies/address?street="+e+"&city="+r+"&state=ca&zip="+n+"&benchmark=8&vintage=8&layers=8&format=jsonp";return a(o,e,i,n,r),document.getElementById("form").reset(),!1});var r=(topojson.feature(e,e.objects.tracts),function(t){var e=t.parentNode;e.removeChild(t)}),n=function(t,e,a,n,o){t.addEventListener("click",function(){r(t),i(a.properties.GEOID,!0),selected[a.properties.NAME]=void 0}),t.addEventListener("mouseover",function(){t.style.background="red"}),t.addEventListener("mouseout",function(){t.style.background=""})},i=function(t,e){s.selectAll(".tract").filter(function(e){return e.properties.GEOID===t}).style("fill",function(t){return e?numbers?educationScaleNum(parseFloat(t.properties.numInCol,10)||0):educationScale(parseFloat(t.properties.inColCent,10)||0):"orange"}),y.selectAll(".tract-2").filter(function(e){return e.properties.GEOID===t}).style("fill",function(t){return e?numbers?healthScaleNum(parseFloat(t.properties.total_insured,10)||0):healthScale(parseFloat(t.properties.percent_insured,10)||0):"orange"}),S.selectAll(".tract-3").filter(function(e){return e.properties.GEOID===t}).style("fill",function(t){return e?numbers?povertyScaleNum(parseFloat(t.properties.total_poverty,10)||0):povertyScale(parseFloat(t.properties.percent_poverty,10)||0):"orange"})},o=function(t,e){geoid=t.properties.GEOID,s.selectAll(".tract").filter(function(t){return t.properties.GEOID===geoid}).style("opacity",function(t){return e?"0.5":"1"}),y.selectAll(".tract-2").filter(function(t){return t.properties.GEOID===geoid}).style("opacity",function(t){return e?"0.5":"1"}),S.selectAll(".tract-3").filter(function(t){return t.properties.GEOID===geoid}).style("opacity",function(t){return e?"0.5":"1"})},l=function(t,e,a,r){var i=document.getElementById("table1"),o=document.createElement("TR");o.setAttribute("id","row"+e.properties.GEOID);var l=document.createElement("TD");l.innerHTML=e.properties.GEOID,o.appendChild(l),l=document.createElement("TD"),l.innerHTML=e.properties.county_name,o.appendChild(l),l=document.createElement("TD"),l.innerHTML=e.properties.population,o.appendChild(l),l=document.createElement("TD"),l.innerHTML=e.properties.numInCol,o.appendChild(l),l=document.createElement("TD"),l.innerHTML=e.properties.inColCent,o.appendChild(l),l=document.createElement("TD"),l.innerHTML=e.properties.total_insured,o.appendChild(l),l=document.createElement("TD"),l.innerHTML=e.properties.percent_insured,o.appendChild(l),l=document.createElement("TD"),l.innerHTML=e.properties.total_poverty,o.appendChild(l),l=document.createElement("TD"),l.innerHTML=e.properties.percent_poverty,o.appendChild(l),i.appendChild(o),n(o,t,e,a,r)},s=g.append("g").attr("transform","translate("+mapX+","+mapY+")"),c=s.selectAll(".tract1").data(topojson.feature(e,e.objects.tracts).features).enter().append("g").attr("class","tract1").append("path").attr("class","tract").attr("id",function(t){return"P"+parseInt(t.properties.GEOID)}).style("fill",function(t){return educationScale(parseFloat(t.properties.inColCent,10)||0)}).attr("d",path).on("mouseover",function(t){mouseover(t),o(t,!0)}).on("mouseout",function(t){mouseout(t),o(t,!1)}).on("mousemove",function(t){mousemove(t)}).on("click",function(t){if(console.log(this.id),void 0===selected[t.properties.GEOID])selected[t.properties.GEOID]=this,l(this,t,educationScale,"inColCent"),i(t.properties.GEOID,!1);else{i(t.properties.GEOID,!0),selected[t.properties.GEOID]=void 0;var e=document.getElementById("row"+t.properties.GEOID);e.parentElement.removeChild(e)}});s.append("path").datum(topojson.mesh(e,e.objects.counties,function(t,e){return t!==e})).attr("class","county-border").attr("d",path);var p=-90,u=height-35;keyAxis.tickValues(educationScale.domain());var d=s.append("g").attr("class","key").attr("transform","translate("+p+","+u+")");d.selectAll("legend1-rect").data(educationScale.range().map(function(t){var e=educationScale.invertExtent(t);return null===e[0]&&(e[0]=keyScale.domain()[0]),null===e[1]&&(e[1]=keyScale.domain()[1]),e})).enter().append("rect").attr("class","legend1-rect").attr("x",function(t){return 0!==t[1]?keyScale(t[0]):void 0}).attr("width",function(t){return 0!==t[1]?keyScale(t[1])-keyScale(t[0]):void 0}).attr("height",15).style("fill",function(t){return educationScale(t[0])});d.call(keyAxis).append("text").attr("class","legend1-caption").attr("x",5).attr("y",-9).attr("dy",".35em").style("font-size","12px").text("Percentage of population age 18 and over enrolled in college"),keyAxisNum.tickValues(educationScaleNum.domain());var m=s.append("g").attr("class","key").attr("visibility","hidden").attr("transform","translate("+p+","+u+")");m.selectAll("legend1Num-rect").data(educationScaleNum.range().map(function(t){var e=educationScaleNum.invertExtent(t);return null===e[0]&&(e[0]=keyScaleNum.domain()[0]),null===e[1]&&(e[1]=keyScaleNum.domain()[1]),e})).enter().append("rect").attr("class","legend1Num-rect").attr("x",function(t){return 0!==t[1]?keyScaleNum(t[0]):void 0}).attr("width",function(t){return 0!==t[1]?keyScaleNum(t[1])-keyScaleNum(t[0]):void 0}).attr("height",15).style("fill",function(t){return educationScaleNum(t[0])});m.call(keyAxisNum).append("text").attr("class","legend1Num-caption").attr("x",5).attr("y",-10).attr("dy",".35em").style("font-size","13px").text("Total number of people age 18 and over enrolled in college");var y=g.append("g").attr("visibility","hidden"),v=y.selectAll(".tract2").data(topojson.feature(e,e.objects.tracts).features).enter().append("g").attr("class","tract2").append("path").attr("class","tract-2").style("fill",function(t){return healthScale(parseFloat(t.properties.percent_insured,10)||0)}).attr("d",path).on("mouseover",function(t){mouseover(t),o(t,!0)}).on("mouseout",function(t){mouseout(t),o(t,!1)}).on("mousemove",function(t){mousemove(t)}).on("click",function(t){if(void 0===selected[t.properties.GEOID])selected[t.properties.GEOID]=this,l(this,t,healthScale,"percent_insured"),i(t.properties.GEOID,!1);else{i(t.properties.GEOID,!0),selected[t.properties.GEOID]=void 0;var e=document.getElementById("row"+t.properties.GEOID);e.parentElement.removeChild(e)}});y.append("path").datum(topojson.mesh(e,e.objects.counties,function(t,e){return t!==e})).attr("class","county-border").attr("d",path);var f=-90,h=height-35;keyAxis.tickValues(healthScale.domain()),tickDistance=healthScale.domain();var b=y.append("g").attr("class","key").attr("transform","translate("+f+","+h+")");b.selectAll("legend2-rect").data(healthScale.range().map(function(t){var e=healthScale.invertExtent(t);return null===e[0]&&(e[0]=keyScale.domain()[0]),null===e[1]&&(e[1]=keyScale.domain()[1]),e})).enter().append("rect").attr("class","legend2-rect").attr("x",function(t){return 0!==t[1]?keyScale(t[0]):void 0}).attr("width",function(t){return 0!==t[1]?keyScale(t[1])-keyScale(t[0]):void 0}).attr("height",15).style("fill",function(t){return healthScale(t[0])});b.call(keyAxis).append("text").attr("class","legend2-caption").attr("x",5).attr("y",-10).attr("dy",".35em").style("font-size","14px").text("Percentage of population with health insurance"),keyScaleNum.range([0,.015]),keyAxisNum.tickValues(healthScaleNum.domain()),tickDistanceNum=healthScaleNum.domain();var k=y.append("g").attr("class","key").attr("visibility","hidden").attr("transform","translate("+f+","+h+")");k.selectAll("legend2Num-rect").data(healthScaleNum.range().map(function(t){var e=healthScaleNum.invertExtent(t);return null===e[0]&&(e[0]=keyScaleNum.domain()[0]),null===e[1]&&(e[1]=keyScaleNum.domain()[1]),e})).enter().append("rect").attr("class","legend2Num-rect").attr("x",function(t){return 0!==t[1]?keyScaleNum(t[0]):void 0}).attr("width",function(t){return 0!==t[1]?keyScaleNum(t[1])-keyScaleNum(t[0]):void 0}).attr("height",15).style("fill",function(t){return healthScaleNum(t[0])});k.call(keyAxisNum).append("text").attr("class","legend2Num-caption").attr("x",5).attr("y",-10).attr("dy",".35em").style("font-size","14px").text("Total number of people with health insurance");var S=g.append("g").attr("visibility","hidden"),x=S.selectAll(".tract3").data(topojson.feature(e,e.objects.tracts).features).enter().append("g").attr("class","tract3").append("path").attr("class","tract-3").style("fill",function(t){return povertyScale(parseFloat(t.properties.percent_poverty,10)||0)}).attr("d",path).on("mouseover",function(t){mouseover(t),o(t,!0)}).on("mouseout",function(t){mouseout(t),o(t,!1)}).on("mousemove",function(t){mousemove(t)}).on("click",function(t){if(void 0===selected[t.properties.GEOID])selected[t.properties.GEOID]=this,l(this,t,povertyScale,"percent_poverty"),i(t.properties.GEOID,!1);else{i(t.properties.GEOID,!0),selected[t.properties.GEOID]=void 0;var e=document.getElementById("row"+t.properties.GEOID);e.parentElement.removeChild(e)}});S.append("path").datum(topojson.mesh(e,e.objects.counties,function(t,e){return t!==e})).attr("class","county-border").attr("d",path);var E=-90,N=height-35;keyAxis.tickValues(povertyScale.domain()),tickDistance=povertyScale.domain();var D=S.append("g").attr("class","key").attr("transform","translate("+E+","+N+")");D.selectAll("legend3-rect").data(povertyScale.range().map(function(t){var e=povertyScale.invertExtent(t);return null===e[0]&&(e[0]=keyScale.domain()[0]),null===e[1]&&(e[1]=keyScale.domain()[1]),e})).enter().append("rect").attr("class","legend3-rect").attr("x",function(t){return 0!==t[1]?keyScale(t[0]):void 0}).attr("width",function(t){return 0!==t[1]?keyScale(t[1])-keyScale(t[0]):void 0}).attr("height",15).style("fill",function(t){return povertyScale(t[0])});D.call(keyAxis).append("text").attr("class","legend3-caption").attr("x",5).attr("y",-10).attr("dy",".35em").style("font-size","14px").text("Percentage of population below poverty level"),keyScaleNum.range([0,.06]),keyAxisNum.tickValues(povertyScaleNum.domain()).tickFormat(function(t){var e=tickDistanceNum.indexOf(t),a=e-1;return 0===e||tickDistanceNum[e]-tickDistanceNum[a]>380?Math.round(t):void 0}),tickDistanceNum=povertyScaleNum.domain();var I=S.append("g").attr("class","key").attr("visibility","hidden").attr("transform","translate("+E+","+N+")");I.selectAll("legend3Num-rect").data(povertyScaleNum.range().map(function(t){var e=povertyScaleNum.invertExtent(t);return null===e[0]&&(e[0]=keyScaleNum.domain()[0]),null===e[1]&&(e[1]=keyScaleNum.domain()[1]),e})).enter().append("rect").attr("class","legend3Num-rect").attr("x",function(t){return 0!==t[1]?keyScaleNum(t[0]):void 0}).attr("width",function(t){return 0!==t[1]?keyScaleNum(t[1])-keyScaleNum(t[0]):void 0}).attr("height",15).style("fill",function(t){return povertyScaleNum(t[0])});I.call(keyAxisNum).append("text").attr("class","legend3Num-caption").attr("x",5).attr("y",-10).attr("dy",".35em").style("font-size","14px").text("Total number of people below poverty level"),d3.selectAll(".overlay_button").on("change",function(){var t=this.id;switch(t){case"education_box":break;case"health_box":break;case"poverty_box":}}),d3.select("#wrapper").remove(),activeEduButton();var C="true",w="false",G="false";$("#selector button").click(function(){"button_education"==$(event.target).attr("id")?C=$(event.target).attr("value"):"button_health"==$(event.target).attr("id")?w=$(event.target).attr("value"):"button_poverty"==$(event.target).attr("id")&&(G=$(event.target).attr("value")),"true"==C&&"true"==w&&"true"==G?(s.transition().duration(750).attr("visibility","visible").attr("transform","translate("+map31X+","+map31Y+")"),y.transition().duration(750).attr("visibility","visible").attr("transform","translate("+map32X+","+map32Y+")"),S.transition().duration(750).attr("visibility","visible").attr("transform","translate("+map33X+","+map33Y+")")):"true"==C&&"true"==w?(s.transition().duration(750).attr("visibility","visible").attr("transform","translate("+map21X+","+map21Y+")"),y.transition().duration(750).attr("visibility","visible").attr("transform","translate("+map22X+","+map22Y+")"),S.attr("visibility","hidden")):"true"==C&&"true"==G?(s.transition().duration(750).attr("visibility","visible").attr("transform","translate("+map21X+","+map21Y+")"),S.transition().duration(750).attr("visibility","visible").attr("transform","translate("+map22X+","+map22Y+")"),y.attr("visibility","hidden")):"true"==w&&"true"==G?(y.transition().duration(750).attr("visibility","visible").attr("transform","translate("+map21X+","+map21Y+")"),S.transition().duration(750).attr("visibility","visible").attr("transform","translate("+map22X+","+map22Y+")"),s.attr("visibility","hidden")):"true"==C?(s.transition().duration(750).attr("visibility","visible").attr("transform","translate("+mapX+","+mapY+")"),y.attr("visibility","hidden"),S.attr("visibility","hidden")):"true"==w?(s.attr("visibility","hidden"),y.transition().duration(750).attr("visibility","visible").attr("transform","translate("+mapX+","+mapY+")"),S.attr("visibility","hidden")):"true"==G&&(s.attr("visibility","hidden"),y.attr("visibility","hidden"),S.transition().duration(750).attr("visibility","visible").attr("transform","translate("+mapX+","+mapY+")"))}),$("#switcher").click(function(){for(key in selected)if(void 0!=selected[key]){selected[key]=void 0;var t=document.getElementById("row"+key);if(null===t)continue;t.parentElement.removeChild(t)}numbers=!numbers,"toggler"===$("#filt-css").attr("class")?(c.transition().duration(450).style("fill",function(t){return educationScaleNum(t.properties.numInCol)}),v.transition().duration(450).style("fill",function(t){return healthScaleNum(t.properties.total_insured)}),x.transition().duration(450).style("fill",function(t){return povertyScaleNum(t.properties.total_poverty)}),m.attr("visibility",""),d.attr("visibility","hidden"),k.attr("visibility",""),b.attr("visibility","hidden"),I.attr("visibility",""),D.attr("visibility","hidden")):(c.transition().duration(450).style("fill",function(t){return educationScale(parseFloat(t.properties.inColCent,10)||0)}),v.transition().duration(450).style("fill",function(t){return healthScale(parseFloat(t.properties.percent_insured,10)||0)}),x.transition().duration(450).style("fill",function(t){return povertyScale(parseFloat(t.properties.percent_poverty,10)||0)}),m.attr("visibility","hidden"),d.attr("visibility",""),k.attr("visibility","hidden"),b.attr("visibility",""),I.attr("visibility","hidden"),D.attr("visibility",""))})});var div=d3.select("body").append("div").attr("class","tooltip").style("display","none");d3.select(self.frameElement).style("height",height+"px");