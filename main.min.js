var incrementColor=function(a,b){var c=parseInt(a.substr(1),16),d=parseInt(b);if(!isNaN(c)&&!isNaN(d)){c+=d;var e=c.toString(16);if(e="#"+new Array(7-e.length).join(0)+e,/^#[0-9a-f]{6}$/i.test(e))return e}return a},width=1500,height=800,projection=d3.geo.mercator().scale(3e3).center([-120,36]).translate([240,height/2+10]),path=d3.geo.path().projection(projection),svg=d3.select("#map").append("svg").attr("width",width).attr("height",height),color=d3.scale.threshold().domain([1,10,50,100,500,1e3,2e3,5e3]).range(["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]),largestDiv4=4525303421,tractScale=d3.scale.threshold().domain([largestDiv4/8,largestDiv4/2,2*largestDiv4,3*largestDiv4,4*largestDiv4+1]).range(colorbrewer.Reds[5]),horizontalLegend=d3.svg.legend().cellWidth(130).units("land area \u33a1").cellHeight(25).inputScale(tractScale).cellStepping(120);d3.select("svg").append("g").attr("transform","translate(260,70)").attr("class","legend").call(horizontalLegend);var formatNumber=d3.format(",d"),x=d3.scale.linear().domain([0,5100]).range([0,480]),xAxis=d3.svg.axis().scale(x).orient("bottom").tickSize(13).tickValues(color.domain()).tickFormat(function(a){return a>=100?formatNumber(a):null}),g=svg.append("g").attr("class","key").attr("transform","translate(540,40)"),tractColors="#000000",numTracts=0;d3.json("dataSets/caTractsAndCounties.json",function(a,b){if(a)throw a;svg.append("g").selectAll("path").data(topojson.feature(b,b.objects.tracts).features).enter().append("path").attr("class","tract").style("fill",function(a){return numTracts++,tractColors=incrementColor(tractColors,2086.2),tractScale(a.properties.ALAND)}).attr("d",path),svg.append("g").selectAll("path").data(topojson.feature(b,b.objects.counties).features).enter().append("path").attr("class","county").attr("d",path).on("mouseover",function(a){c.transition().style("opacity",.9),c.html(a.properties.NAME).style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-30+"px")}).on("mouseout",function(a){c.transition().style("opacity",0)});var c=d3.select("#map").append("div").attr("class","tooltip").style("opacity",0)}),d3.select(self.frameElement).style("height",height+"px");